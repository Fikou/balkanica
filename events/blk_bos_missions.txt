namespace = bos_missions

# clears serbian gold mines
country_event = {
 id = bos_missions.1
 title = bos_missions.1.title
 desc = bos_missions.1.desc
 picture = TRADE_GOODS_METALS_AND_MINING_EQUIPENT_eventPicture

 trigger = {
  any_owned_province = {
   has_province_flag = bos_temp_exploiting_silver
   has_province_modifier = bos_temp_silver_mining
   trade_goods = gold
  }
 }

 mean_time_to_happen = {
  months = 12
 }

 option = {
  name = bos_missions.1.a
  every_owned_province = {
   limit = {
    has_province_flag = bos_temp_exploiting_silver
    has_province_modifier = bos_temp_silver_mining
    trade_goods = gold
   }
   clr_province_flag = bos_temp_exploiting_silver
   change_trade_goods = random
   add_base_production = -2
  }
 }
}

#papal legate
country_event = {
 id = bos_missions.2
 title = bos_missions.2.title
 desc = bos_missions.2.desc
 picture = CHURCH_ESTATE_1_eventPicture

 fire_only_once = yes
 major = yes
 major_trigger = {
  religion = krstjani
  tag = PAP
 }
 trigger = { # i'm not adding a trigger to check if the pope exists. they probably exist this early into the game.
   tag = BOS
   religion = krstjani
   NOT = { has_country_flag = blk_catholic }
   NOT = { has_country_flag = blk_krstjani }
   mission_completed = bos_resolve_civil_war
  }

 mean_time_to_happen = {
  months = 72
 }

 option = {
  name = bos_missions.2.a
  hidden_effect = {
   set_country_flag = blk_krstjani
  }
  custom_tooltip = bos_missions_2_krstjani_tt
  PAP = {
   add_opinion = {
    who = ROOT
    modifier = pope_rebuffed
   }
  }
  add_opinion = {
   who = PAP
   modifier = pope_rebuffed
  }
  swap_non_generic_missions = yes
  ai_chance = {
   factor = 80
  }
 }
 option = {
  name = bos_missions.2.b
  hidden_effect = {
   set_country_flag = blk_catholic
  }
  custom_tooltip = bos_missions_2_catholic_tt
  PAP = {
   add_opinion = {
    who = ROOT
    modifier = pope_accepted
   }
  }
  add_opinion = {
   who = PAP
   modifier = pope_accepted
  }
  add_stability = -1
  change_religion = catholic
  every_owned_province = {
   limit = {
    religion = krstjani
   }
   spawn_rebels = {
    type = heretic_rebels
    size = 0.75
   }
  }
  swap_non_generic_missions = yes
  ai_chance = {
   factor = 20
   modifier = {
    factor = 0
    NOT = { stability = 2 } # ai manages to get up to 2 stab, sure, they can convert. but i'd rather they not nation ruin
   }
   modifier = {
    factor = 0
    NOT = { manpower_percentage = 0.25 } # likewise, ai doesn't have the manpower to handle rebels - don't nation ruin
   }
  }
 }
}

# hungary support post-civil-war resolved
country_event = {
 id = bos_missions.3
 title = bos_missions.3.title
 desc = bos_missions.3.desc
 picture = ANGRY_MOB_eventPicture

 fire_only_once = yes
 trigger = {
  tag = BOS
  mission_completed = bos_resolve_civil_war
  bos_has_country_support_trigger = { faction = HUN }
 }

 mean_time_to_happen = {
  months = 72
 }

 option = {
  name = bos_missions.3.a
  add_stability = -1
 }
}

# austria support post-civil-war resolved
country_event = {
 id = bos_missions.4
 title = bos_missions.4.title
 desc = bos_missions.4.desc
 picture = NOBLE_ESTATE_TAKE_OVER_eventPicture

 fire_only_once = yes
 trigger = {
  tag = BOS
  HAB = { exists = yes }
  mission_completed = bos_resolve_civil_war
  bos_has_country_support_trigger = { faction = HAB }
 }

 mean_time_to_happen = {
  months = 72
 }

 option = {
  name = bos_missions.4.a
  croatia_area = {
   add_claim = HAB
  }
  east_adriatic_coast_area = {
   limit = {
    NOT = { province_id = 137 }
   }
   add_claim = HAB
  }
  ai_chance = {
   factor = 100
  }
 }
 option = {
  name = bos_missions.4.b
  HAB = {
   add_casus_belli = {
    target = ROOT
    type = cb_vassalize_mission
    months = 300
   }
  }
  ai_chance = {
   factor = 0
  }
 }
}

# serbia support post-civil-war resolved
country_event = {
 id = bos_missions.5
 title = bos_missions.5.title
 desc = bos_missions.5.desc
 picture = NOBLE_ESTATE_DEMANDS_eventPicture

 fire_only_once = yes
 trigger = {
  tag = BOS
  SER = { exists = yes }
  mission_completed = bos_resolve_civil_war
  bos_has_country_support_trigger = { faction = SER }
 }

 mean_time_to_happen = {
  months = 72
 }

 option = {
  name = bos_missions.5.a
  add_truce_with = SER
  ai_chance = {
   factor = 100
  }
 }
 option = {
  name = bos_missions.5.b
  SER = {
   add_casus_belli = {
    target = ROOT
    type = cb_border_war
    months = 240
   }
  }
  ai_chance = {
   factor = 0
  }
 }
}

# aragon support post-civil-war resolved
country_event = {
 id = bos_missions.6
 title = bos_missions.6.title
 desc = bos_missions.6.desc
 picture = NOBLE_ESTATE_TAKE_OVER_eventPicture

 fire_only_once = yes
 trigger = {
  tag = BOS
  ARA = { exists = yes }
  mission_completed = bos_resolve_civil_war
  bos_has_country_support_trigger = { faction = ARA }
 }

 mean_time_to_happen = {
  months = 72
 }

 option = {
  name = bos_missions.6.a
  ARA = { create_vassal = ROOT }
  ai_chance = {
   factor = 0
  }
 }
 option = {
  name = bos_missions.6.b
  ARA = {
   add_casus_belli = {
    target = ROOT
    type = cb_vassalize_mission
    months = 480
   }
  }
  ai_chance = {
   factor = 100
  }
 }
}

# hum and ragusa revolt!
country_event = {
 id = bos_missions.7
 title = bos_missions.7.title
 desc = bos_missions.7.desc
 picture = ANGRY_MOB_eventPicture

 fire_only_once = yes
 trigger = {
  tag = BOS
  has_country_flag = bos_hum_ragusa_revolt
 }

 mean_time_to_happen = {
  months = 72
 }

 immediate = {
  139 = {
   spawn_rebels = {
    size = 2
    type = noble_rebels
    friend = RAG
    should_take_capital = yes
    win = yes
   }
  }
  1831 = {
   spawn_rebels = {
    size = 1
    type = noble_rebels
    friend = RAG
    should_take_capital = yes
    win = yes
   }
  }
  137 = {
   spawn_rebels = {
    size = 1
    type = nationalist_rebels
    friend = RAG
    separatists_target = RAG
    should_take_capital = yes
   }
  }
 }

 option = {
  name = bos_missions.7.a
  hidden_effect = {
   clr_country_flag = bos_hum_ragusa_revolt
  }
 }
}

# fire ottoman prepared buff
country_event = {
 id = bos_missions.8
 title = bos_missions.8.title
 desc = bos_missions.8.desc
 picture = RELIGIOUS_WARS_eventPicture

 fire_only_once = yes
 trigger = {
  tag = BOS
  OR = {
   AND = {
    tur_owns_any_balkan_provices = yes
    OR = {
     defensive_war_with = TUR
     offensive_war_with = TUR
    }
   }
   AND = {
    tur_owns_any_balkan_provices = no
    any_country = {
     OR = {
      defensive_war_with = ROOT
      offensive_war_with = ROOT
     }
     AND = {
      land_forcelimit = ROOT
      total_development = ROOT
     }
    }
   }
  }
  has_country_flag = bos_prepared_for_ottoman_invasion
 }

 mean_time_to_happen = {
  days = 30
 }

 option = {
  name = bos_missions.8.a
  hidden_effect = {
   clr_country_flag = bos_prepared_for_ottoman_invasion
  }
  if = {
   limit = {
    any_country = {
     offensive_war_with = ROOT
    }
   }
   add_country_modifier = {
    name = bos_defensive_ottoman_invasion_buff
    duration = -1
   }
  }
  else = {
   add_country_modifier = {
    name = bos_offensive_ottoman_invasion_buff
    duration = -1
   }
  }
 }
}

# remove the buffs when the war ends
country_event = {
 id = bos_missions.9
 title = bos_missions.9.title
 desc = bos_missions.9.desc
 picture = MARCHING_PEASANTS_eventPicture

 trigger = {
  tag = BOS
  is_at_war = no
  OR = {
   has_country_modifier = bos_defensive_ottoman_invasion_buff
   has_country_modifier = bos_offensive_ottoman_invasion_buff
  }
 }

 mean_time_to_happen = {
  days = 3
 }

 option = {
  name = bos_missions.9.a
  remove_country_modifier = bos_defensive_ottoman_invasion_buff
  remove_country_modifier = bos_offensive_ottoman_invasion_buff
 }
}

# integrate or exile the djed
country_event = {
 id = bos_missions.10
 title = bos_missions.10.title
 desc = bos_missions.10.desc
 picture = CHURCH_ESTATE_1_eventPicture

 is_triggered_only = yes

 option = {
  name = bos_missions.10.a
  add_country_modifier = {
   name = bos_integrated_djed
   duration = -1
  }
  ai_chance = {
   factor = 80
  }
 }
 option = {
  name = bos_missions.10.b
  add_country_modifier = {
   name = bos_exiled_djed
   duration = -1
  }
  ai_chance = {
   factor = 20
  }
 }
}
